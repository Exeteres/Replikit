# Контроллеры

Контроллер - это мост между ядром и конкретным мессенджером или соцсетью.
Все контроллеры имеют единый интерфейс, благодаря которому один и тот же код может работать
сразу с несколькими разными платформами.

## Проверка функционала

Интерфейсы ядра спроектированы таким образом, чтобы их было удобно использовать как в клиентском коде, так и в коде контроллеров.
Тем не менее, разработать полностью универсальный интерфейс невозможно из-за технических различий платформ.
Поэтому у каждого контроллера существует объект `features`, содержащий флаги, обозначающие поддерживаемые функции.
Например, Telegram поддерживает передачу вложений по прямым ссылкам, в то время как в VK необходимо явно загружать вложения на сервер.
Это поведение контролируется флагом `explicitUpload`.

## Проверка доступа

Интерфейс `ChannelInfo` содержит объект `permissions` с флагами, обозначающими наличие определенных разрешений в конкретном канале.
Система разрешений есть у всех поддерживаемых на данный момент платформ.

## Токенизация

Каждая платформа имеет свою собственную систему форматирования текста.
В VK это система упоминаний и ссылок на сообщества, в Telegram и Discord используется Markdown.
Для обеспечения совместимости между текстом из разных платформ, все контроллеры поддерживают метод `tokenizeText`,
который разбивает текст сообщения на токены и метод `formatText`, который преобразует массив токенов в текст.

## Особенности платформ

### Telegram

- Все сообщения одной медиагруппы (альбома) автоматически объединяются в одно сообщение;
- Интерфейс `InMessage` расширяется объектом `telegram`, содержащим массив `entities` и объект `dice`;
- Сообщение при отправке может разделиться (визуально) на несколько сообщений, если оно содержит вложения разных типов, которые нельзя объединить в медиагруппу.
Фактически же любое сообщение с несколькими вложениями - это группа из нескольких сообщений.

### VK

- Удалять, редактировать и пересылать сообщения можно только если беседа создана от имени группы бота.
